Ember.TEMPLATES["javascripts/discourse-user-notes/templates/connectors/admin-user-controls-after/add-user-notes-button"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[1,[29,"show-user-notes",null,[["show","count"],["showUserNotes",[25,["userNotesCount"]]]]],false],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse-user-notes/templates/connectors/admin-user-controls-after/add-user-notes-button"}}),Ember.TEMPLATES["javascripts/discourse-user-notes/templates/connectors/user-card-post-names/show-user-notes-on-card"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[25,["userNotesCount"]]],null,{"statements":[[0,"  "],[7,"a"],[11,"href",""],[12,"title",[30,[[23,"userNotesTitle"]]]],[9],[0,"\\n"],[4,"if",[[25,["emojiEnabled"]]],null,{"statements":[[0,"      "],[7,"img"],[12,"src",[23,"emojiUrl"]],[12,"title",[23,"userNotesTitle"]],[11,"alt","pencil"],[11,"class","emoji"],[9],[10],[0,"\\n"]],"parameters":[]},{"statements":[[0,"      "],[1,[29,"d-icon",["sticky-note"],null],false],[0,"\\n"]],"parameters":[]}],[0,"  "],[3,"action",[[24,0,[]],"showUserNotes"]],[10],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse-user-notes/templates/connectors/user-card-post-names/show-user-notes-on-card"}}),Ember.TEMPLATES["javascripts/discourse-user-notes/templates/connectors/user-profile-controls/show-notes-on-profile"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"li"],[9],[1,[29,"show-user-notes",null,[["show","count"],["showUserNotes",[25,["userNotesCount"]]]]],false],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/discourse-user-notes/templates/connectors/user-profile-controls/show-notes-on-profile"}}),Ember.TEMPLATES["javascripts/discourse-user-notes/templates/connectors/flagged-post-controls/show-user-notes-on-flags"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[25,["userNotesCount"]]],null,{"statements":[[0,"  "],[1,[29,"show-user-notes",null,[["show","count"],["showUserNotes",[25,["userNotesCount"]]]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/discourse-user-notes/templates/connectors/flagged-post-controls/show-user-notes-on-flags"}}),define("discourse/plugins/discourse-user-notes/discourse-user-notes/connectors/admin-user-controls-after/add-user-notes-button",["exports","discourse/plugins/discourse-user-notes/discourse-user-notes/connectors/user-profile-controls/show-notes-on-profile"],function(e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=s.default}),define("discourse/plugins/discourse-user-notes/discourse-user-notes/connectors/user-card-post-names/show-user-notes-on-card",["exports","discourse/plugins/discourse-user-notes/discourse-user-notes/lib/user-notes","discourse-common/lib/get-owner","discourse/lib/text"],function(e,s,t,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,s){var t=s.siteSettings,o=s.currentUser;return t.user_notes_enabled&&o&&o.staff},setupComponent:function(e,s){var t=e.user,n=t.get("user_notes_count")||t.get("custom_fields.user_notes_count")||0;s.set("userNotesCount",n),s.set("emojiEnabled",s.siteSettings.enable_emoji),s.set("emojiUrl",(0,o.emojiUrlFor)("pencil")),s.set("user",t),s.set("userNotesTitle",I18n.t("user_notes.show",{count:n}))},actions:{showUserNotes:function(){var e=this;this.parentView.parentView._close();var o=(0,t.getOwner)(this).lookup("store:main"),n=this.get("args.user");(0,s.showUserNotes)(o,n.get("id"),function(s){e.isDestroying||e.isDestroyed||e.set("userNotesCount",s)})}}}}),define("discourse/plugins/discourse-user-notes/discourse-user-notes/connectors/user-profile-controls/show-notes-on-profile",["exports","discourse/plugins/discourse-user-notes/discourse-user-notes/lib/user-notes","discourse-common/lib/get-owner"],function(e,s,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,s){var t=s.siteSettings,o=s.currentUser;return t.user_notes_enabled&&o&&o.staff},setupComponent:function(e,s){var t=e.model;s.set("userNotesCount",t.get("user_notes_count")||t.get("custom_fields.user_notes_count")||0)},actions:{showUserNotes:function(){var e=this,o=(0,t.getOwner)(this).lookup("store:main"),n=this.get("args.model");(0,s.showUserNotes)(o,n.get("id"),function(s){return e.set("userNotesCount",s)})}}}}),define("discourse/plugins/discourse-user-notes/discourse-user-notes/connectors/flagged-post-controls/show-user-notes-on-flags",["exports","discourse/plugins/discourse-user-notes/discourse-user-notes/lib/user-notes","discourse-common/lib/get-owner"],function(e,s,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={shouldRender:function(e,s){return s.siteSettings.user_notes_enabled},setupComponent:function(e,s){var t=e.flaggedPost.get("user");s.set("userNotesCount",t.get("custom_fields.user_notes_count")||0)},actions:{showUserNotes:function(){var e=this,o=(0,t.getOwner)(this).lookup("store:main"),n=this.get("args.flaggedPost.user");(0,s.showUserNotes)(o,n.get("id"),function(s){return e.set("userNotesCount",s)})}}}}),define("discourse/plugins/discourse-user-notes/discourse-user-notes/lib/user-notes",["exports","discourse/lib/show-modal","discourse/lib/load-script"],function(e,s,t){"use strict";function o(e,o,n,r){return r=r||{},(0,t.default)("defer/html-sanitizer-bundle").then(function(){return e.find("user-note",{user_id:o}).then(function(e){var t=(0,s.default)("user-notes",{model:e,title:"user_notes.title",addModalBodyView:!0});return t.reset(),t.set("userId",o),t.set("callback",n),t.set("postId",r.postId),t})})}Object.defineProperty(e,"__esModule",{value:!0}),e.showUserNotes=o}),Ember.TEMPLATES["javascripts/modal/user-notes"]=Ember.HTMLBars.template({id:null,block:'{"symbols":["n"],"statements":[[4,"d-modal-body",null,[["class"],["user-notes-modal"]],{"statements":[[0,"  "],[1,[29,"textarea",null,[["value"],[[25,["newNote"]]]]],false],[0,"\\n  "],[1,[29,"d-button",null,[["action","label","class","disabled"],["attachNote","user_notes.attach","btn-primary",[25,["attachDisabled"]]]]],false],[0,"\\n\\n"],[4,"each",[[25,["model"]]],null,{"statements":[[0,"    "],[7,"div"],[11,"class","user-note"],[9],[0,"\\n      "],[7,"div"],[11,"class","posted-by"],[9],[0,"\\n"],[4,"user-link",null,[["user"],[[24,1,["created_by"]]]],{"statements":[[0,"          "],[1,[29,"avatar",[[24,1,["created_by"]]],[["imageSize"],["small"]]],false],[0,"\\n"]],"parameters":[]},null],[0,"      "],[10],[0,"\\n      "],[7,"div"],[11,"class","note-contents"],[9],[0,"\\n        "],[7,"div"],[11,"class","note-info"],[9],[0,"\\n          "],[7,"span"],[11,"class","username"],[9],[1,[24,1,["created_by","username"]],false],[10],[0,"\\n          "],[7,"span"],[11,"class","post-date"],[9],[1,[29,"age-with-tooltip",[[24,1,["created_at"]]],null],false],[10],[0,"\\n\\n"],[4,"if",[[24,1,["can_delete"]]],null,{"statements":[[0,"            "],[7,"span"],[11,"class","controls"],[9],[0,"\\n              "],[1,[29,"d-button",null,[["action","icon","class","title"],[[29,"action",[[24,0,[]],"removeNote",[24,1,[]]],null],"far-trash-alt","btn-small btn-danger","user_notes.remove"]]],false],[0,"\\n            "],[10],[0,"\\n"]],"parameters":[]},null],[0,"        "],[10],[0,"\\n\\n        "],[7,"div"],[11,"class","cooked"],[9],[0,"\\n          "],[1,[29,"cook-text",[[24,1,["raw"]]],null],false],[0,"\\n        "],[10],[0,"\\n\\n"],[4,"if",[[24,1,["post_id"]]],null,{"statements":[[0,"          "],[7,"a"],[11,"class","btn btn-small"],[12,"href",[24,1,["post_url"]]],[9],[0,"\\n            "],[1,[29,"i18n",["user_notes.show_post"],null],false],[0,"\\n          "],[10],[0,"\\n"]],"parameters":[]},null],[0,"      "],[10],[0,"\\n\\n      "],[7,"div"],[11,"class","clearfix"],[9],[10],[0,"\\n    "],[10],[0,"\\n"]],"parameters":[1]},null]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/modal/user-notes"}}),Ember.TEMPLATES["javascripts/connectors/admin-dashboard-moderation-bottom/recent-user-notes-report-table"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[4,"if",[[25,["siteSettings","user_notes_enabled"]]],null,{"statements":[[0,"  "],[1,[29,"admin-report",null,[["dataSourceName","startDate","endDate"],["user_notes",[25,["lastWeek"]],[25,["endDate"]]]]],false],[0,"\\n"]],"parameters":[]},null]],"hasEval":false}',meta:{moduleName:"javascripts/connectors/admin-dashboard-moderation-bottom/recent-user-notes-report-table"}}),Ember.TEMPLATES["javascripts/components/show-user-notes"]=Ember.HTMLBars.template({id:null,block:'{"symbols":[],"statements":[[7,"a"],[11,"href",""],[11,"class","btn"],[9],[0,"\\n  "],[1,[29,"d-icon",["pencil-alt"],null],false],[0,"\\n"],[4,"if",[[25,["showCount"]]],null,{"statements":[[0,"    "],[1,[29,"i18n",["user_notes.show"],[["count"],[[25,["count"]]]]],false],[0,"\\n"]],"parameters":[]},{"statements":[[0,"    "],[1,[29,"i18n",["user_notes.title"],null],false],[0,"\\n"]],"parameters":[]}],[3,"action",[[24,0,[]],"show"]],[10],[0,"\\n"]],"hasEval":false}',meta:{moduleName:"javascripts/components/show-user-notes"}}),define("discourse/plugins/discourse-user-notes/discourse/adapters/user-note",["exports","discourse/adapters/rest","discourse/lib/ajax"],function(e,s,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=s.default.extend({destroyRecord:function(e,s,o){var n=this.pathFor(e,s,o.get("id")),r=o.get("user_id");return(0,t.ajax)(n+"?user_id="+r,{method:"DELETE"})}})}),define("discourse/plugins/discourse-user-notes/discourse/components/show-user-notes",["exports","ember-addons/ember-computed-decorators"],function(e,s){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var t,o,n;e.default=Ember.Component.extend((t=(0,s.default)("count"),o={tagName:"",showCount:function(e){return e&&e>0},actions:{show:function(){this.sendAction("show")}}},function(e,s,t,o,n){var r={};return Object.keys(o).forEach(function(e){r[e]=o[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=t.slice().reverse().reduce(function(t,o){return o(e,s,t)||t},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,s,r),r=null),r}(o,"showCount",[t],(n=Object.getOwnPropertyDescriptor(o,"showCount"),n=n?n.value:void 0,{enumerable:!0,configurable:!0,writable:!0,initializer:function(){return n}}),o),o))}),define("discourse/plugins/discourse-user-notes/discourse/initializers/enable-user-notes",["exports","discourse/lib/plugin-api","discourse-common/lib/icon-library","discourse/plugins/discourse-user-notes/discourse-user-notes/lib/user-notes"],function(e,s,t,o){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default={name:"enable-user-notes",initialize:function(e){var n=e.lookup("site-settings:main"),r=e.lookup("current-user:main");if(n.user_notes_enabled&&r&&r.staff){var i=e.lookup("store:main");(0,s.withPluginApi)("0.8.15",function(e){function s(){var e=this;(0,o.showUserNotes)(i,this.attrs.user_id,function(s){e.sendWidgetAction("refreshUserNotes",s)},{postId:this.attrs.id})}e.attachWidgetAction("post","refreshUserNotes",function(e){var s=this.model.get("user_custom_fields")||{};s.user_notes_count=e,this.model.set("user_custom_fields",s)}),e.modifyClass("controller:user",{userNotesCount:null,_modelChanged:function(){this.set("userNotesCount",this.get("model.custom_fields.user_notes_count")||0)}.observes("model").on("init"),actions:{showUserNotes:function(){var e=this,s=this.get("model");(0,o.showUserNotes)(i,s.get("id"),function(s){return e.set("userNotesCount",s)})}}});var r=e.container.lookup("site:main").mobileView,u=r?"before":"after";e.decorateWidget("poster-name:"+u,function(e){if(!e.widget.settings.hideNotes){return(e.attrs.userCustomFields||{}).user_notes_count>0?e.attach("user-notes-icon"):void 0}}),e.decorateWidget("post-avatar:after",function(e){if(e.widget.settings.showNotes){return(e.attrs.userCustomFields||{}).user_notes_count>0?e.attach("user-notes-icon"):void 0}}),e.decorateWidget("post-admin-menu:after",function(e){return e.attach("post-admin-menu-button",{icon:"pencil",label:"user_notes.attach",action:"showUserNotes"})}),e.attachWidgetAction("post","showUserNotes",s),e.createWidget("user-notes-icon",{tagName:"span.user-notes-icon",click:s,html:function(){return n.enable_emoji?this.attach("emoji",{name:"pencil"}):(0,t.iconNode)("sticky-note")}})})}}}}),define("discourse/plugins/discourse-user-notes/discourse/controllers/user-notes",["exports","ember-addons/ember-computed-decorators","discourse/lib/ajax-error"],function(e,s,t){"use strict";function o(e,s,t,o,n){var r={};return Object.keys(o).forEach(function(e){r[e]=o[e]}),r.enumerable=!!r.enumerable,r.configurable=!!r.configurable,("value"in r||r.initializer)&&(r.writable=!0),r=t.slice().reverse().reduce(function(t,o){return o(e,s,t)||t},r),n&&void 0!==r.initializer&&(r.value=r.initializer?r.initializer.call(n):void 0,r.initializer=void 0),void 0===r.initializer&&(Object.defineProperty(e,s,r),r=null),r}Object.defineProperty(e,"__esModule",{value:!0});var n,r,i;e.default=Ember.Controller.extend((n=(0,s.on)("init"),r=(0,s.default)("newNote","saving"),i={newNote:null,saving:!1,user:null,reset:function(){this.setProperties({newNote:null,saving:!1,callback:null})},attachDisabled:function(e,s){return s||!e||0===e.length},_refreshCount:function(){var e=this.get("callback");e&&e(this.get("model.length"))},actions:{attachNote:function(){var e=this,s=this.store.createRecord("user-note"),o=parseInt(this.get("userId"));this.set("saving",!0);var n={raw:this.get("newNote"),user_id:o},r=this.get("postId");r&&(n.post_id=parseInt(r)),s.save(n).then(function(){e.set("newNote",""),e.get("model").insertAt(0,s),e._refreshCount()}).catch(t.popupAjaxError).finally(function(){return e.set("saving",!1)})},removeNote:function(e){var s=this;bootbox.confirm(I18n.t("user_notes.delete_confirm"),I18n.t("no_value"),I18n.t("yes_value"),function(o){o&&e.destroyRecord().then(function(){s.get("model").removeObject(e),s._refreshCount()}).catch(t.popupAjaxError)})}}},o(i,"reset",[n],Object.getOwnPropertyDescriptor(i,"reset"),i),o(i,"attachDisabled",[r],Object.getOwnPropertyDescriptor(i,"attachDisabled"),i),i))});
//# sourceMappingURL=/assets/plugins/discourse-staff-notes-2eef046f71d1e35ae05893e23566aaaad67e7256b942ce7187e039c53d6bc409.js.map